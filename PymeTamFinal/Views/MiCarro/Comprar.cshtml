@model PymeTamFinal.Modelos.ModelosAuxiliares.ModeloGuardadoCompra
@{
    ViewBag.Title = "Comprar";
    Layout = "~/Views/Shared/_LayoutTienda.cshtml";
}
@using (Html.BeginForm())
{
    <section id="cart_items">
        <div class="container">
            @*<div class="breadcrumbs">
                <ol class="breadcrumb">
                <li><a href="#">Home</a></li>
                <li class="active">Check out</li>
                </ol>
                </div>*@

            <div class="step-one">
                <h2 class="heading">Comprar</h2>
            </div>
            <div class="checkout-options">
                <h3>Usuario</h3>
                <br />
                @if (User.Identity.IsAuthenticated)
                {

                    <ul class="nav">
                        <li>
                            @User.Identity.Name
                        </li>
                        @*<li>
                            <a href="javascript:document.getElementById('logoutForm').submit()"><i class="fa fa-times"></i>Usar otra cuenta</a>
                            </li>*@
                        <li>
                            <a href=""><i class="fa fa-times"></i>Cancelar compra</a>
                        </li>
                    </ul>
                }
            </div><!--/checkout-options-->

            <div class="register-req">
                <p></p>
            </div><!--/register-req-->

            <div class="shopper-informations">
                <div class="row">
                    @*<div class="col-sm-3">
                        <div class="shopper-info">
                        <p>Shopper Information</p>
                        <form>
                        <input type="text" placeholder="Display Name">
                        <input type="text" placeholder="User Name">
                        <input type="password" placeholder="Password">
                        <input type="password" placeholder="Confirm password">
                        </form>
                        <a class="btn btn-primary" href="">Get Quotes</a>
                        <a class="btn btn-primary" href="">Continue</a>
                        </div>
                        </div>*@
                    <div class="col-sm-6 clearfix">


                        <div class="formularioUno">
                            <div class="bill-to">
                                <p>Información del cliente</p>
                            </div>
                            <label>Nombre</label>
                            @Html.TextBoxFor(a => a.ordenNombre)
                            <label>Primer Apellido</label>
                            @Html.TextBoxFor(a => a.ordenApPaterno)
                            <label>Segundo Apellido</label>
                            @Html.TextBoxFor(a => a.ordenApMaterno)
                            <label>Correo electronico</label>
                            @Html.TextBox("ordenMail", User.Identity.Name)
                            <label>Telefono</label>
                            @Html.TextBoxFor(a => a.ordenTelefono)

                        </div>


                        <div class="formularioDos">

                            <div class="bill-to">
                                <p>Información para el envió</p>
                            </div>
                            <label>Dirección de envio</label>
                            @Html.TextBoxFor(a=>a.ordenDireccion)

                            <label>Codigo postal</label>
                            @Html.TextBoxFor(a=>a.ordenCodigoPostal)
                            <label>País</label>
                            @Html.DropDownList("idPais", (IEnumerable<SelectListItem>)ViewBag.paises, new { @class = "idPais" })
                            <label>Estado</label>
                            @Html.DropDownList("idEstado", (IEnumerable<SelectListItem>)ViewBag.estados)
                            <label>Ciudad, municipio o delegación</label>
                            @Html.TextBoxFor(a => a.ordenCiudad, new { placeHolder = "Ciudad o Provincia" })
                        </div>
                        
                    </div>

                    <div class="col-sm-6">
                        <div class="order-message">
                            <p>Mas información</p>
                            @Html.TextAreaFor(a=>a.ordenClienteComentarios, new { rows= "16" })
                            <label>@Html.EditorFor(a=>a.enviarADirFac) Enviar a dirección de facturación</label>
                            <label>@Html.EditorFor(a => a.requiereFactura) Requiere factura</label>
                         
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <hr />
                        <a class="btn btn-warning" href="@Url.Action("MisDatos", "Clientes", new { returnUrl = Url.Action("Comprar", "MiCarro", new { cupon = ViewBag.cupon }).ToString() })">Editar</a>
                    </div>
                </div>
            </div>
            <div class="review-payment">
                <h2>Resumen &amp; Pago</h2>
            </div>

            @{Html.RenderAction("CarritoDetalle");}
            <div class="payment-options">
                <span>
                    <label><input type="radio" name="pago"> Direct Bank Transfer</label>
                </span>
                <span>
                    <label><input type="radio" name="pago"> Check Payment</label>
                </span>
                <span>
                    <label><input type="radio" name="pago"> Paypal</label>
                </span>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <button type="submit" class="btn btn-primary">Confirmar compra</button>
                </div>
            </div>
        </div>
    </section>
                }

@section Scripts{
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        var callbackLogin = function (data) {
            if (data.ok) {
                window.location.reload();
            }
            else {
                $(".error").text("");
                $(".error").append("<p class='alert alert-danger'>" + data.mensaje + "</p>");
                grecaptcha.reset();
            }
        };
        $(function () {
            //invitado
            //login
            //registro
            $modal = $("#modalLogin");
            $btn = $(".tipo");
            $servicioUrl = "/Account/LoginModal/";
            $servicioUrlRegistro = "/Account/RegistroModal/";
            $funcionModal = function (d) {
                $modal.modal("show");
            };
            $("body").on("change", ".tipo", function () {
                var $tipo = $('input[name="tipo"]:checked').val();
                var $returnUrl = "?returnUrl=" + window.location.pathname.toString();
                var $rtParam = "";

                if ($tipo == "login") {

                    $modal.load($servicioUrl + $returnUrl, $funcionModal);
                }
                if ($tipo == "registro") {
                    $modal.load($servicioUrlRegistro + $returnUrl, $funcionModal);
                }
            });
        });
        $("body").on("change", ".idPais", function () {
            var id = $(this).val();
            var $estados = $("#idEstado");
            $.get("/Clientes/cargaEstados/" + id, function (data) {
                $estados.empty();
                console.log(data);
                $.each(data, function (i, d) {
                    console.log(d);
                    $estados.append("<option value=" + d.idEstado + ">" + d.nombreEstado + "<option>");
                });
                //Limpia los valores vacios
                $("#idEstado option").filter(function () {
                    return !this.value || $.trim(this.value).length == 0;
                })
                .remove();
            });
        });
    </script>
}
@section Fin{
    <div class="modal fade" id="modalLogin" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">

    </div>
}